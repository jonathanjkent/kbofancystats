kbohistory$Date <- ISOdate(kbohistory$Year, kbohistory$Month, kbohistory$Day)
kbohistory <- kbohistory %>% select(Date, Home, Away, H.Score, A.Score, Year)
all.history <- rbind(kbohistory, all.results)
all.history <- all.history[order(all.history$Date),]
all.history$H.Score <- as.double(all.history$H.Score)
all.history$A.Score <- as.double(all.history$A.Score)
## Run Elo
elo <- elo.run(score(H.Score, A.Score) ~ adjust(Home, 24) + Away + regress(Year, 1500, 0.5) + k(4*(abs(H.Score - A.Score)^(1/4))), data = all.history)
all.history$H.Elo <- elo[[1]][,7]
all.history$A.Elo <- elo[[1]][,8]
## Create Elo History Table
home <- all.history %>% select(Date, Home, H.Elo)
away <- all.history %>% select(Date, Away, A.Elo)
cols <- c("Date", "Team", "Elo")
colnames(home) <- cols
colnames(away) <- cols
elo.history <- rbind(home,away)
elo.history$Elo <- round(elo.history$Elo, digits = 0)
## Current Elos
current.elos <- elo.history %>%
group_by(Team) %>%
arrange(desc(Date)) %>%
slice(1) %>% select(-Date) %>%
arrange(desc(Elo))
current.elos$Rank <- 1:10
write_csv(current.elos, "currentelos.csv")
## Ten Team Era for History Page
tenteam <- elo.history %>% filter(Date > ISOdate(2013,1,1))
write_csv(tenteam,"elohistory.csv")
## Simulations
nsim <- 100000
all.schedule$Prediction <- predict(elo, newdata = all.schedule)
all.schedule <- data.frame(all.schedule, Round = rep(1:nsim, each = nrow(all.schedule)))
all.schedule$Sim <- runif((nrow(all.schedule)),0,1)
all.schedule <- mutate(all.schedule, H.Win = ifelse(Sim < Prediction, 1, 0))
all.schedule <- mutate(all.schedule, Winner = ifelse(H.Win == 1, as.character(Home), as.character(Away)))
standings <- all.schedule %>% group_by(Winner, Round) %>% count()
standings <- standings %>% left_join(wins, by = "Winner")
standings$n.y[is.na(standings$n.y)] <- 0
standings$n <- standings$n.x + standings$n.y
standings <- standings %>% arrange(desc(n)) %>% arrange(Round)
standings$Rank <- rep(1:10, max(standings$Round))
pred.1 <- standings %>% filter(Rank == 1) %>% group_by(Winner) %>% count()
pred.1$Pct <- (pred.1$n/nsim)
colnames(pred.1) <- c("Winner", "n", "First")
pred.2 <- standings %>% filter(Rank == 2) %>% group_by(Winner) %>% count()
pred.2$Pct <- (pred.2$n/nsim)
colnames(pred.2) <- c("Winner", "n", "Second")
pred.3 <- standings %>% filter(Rank == 3) %>% group_by(Winner) %>% count()
pred.3$Pct <- (pred.3$n/nsim)
colnames(pred.3) <- c("Winner", "n", "Third")
pred.4 <- standings %>% filter(Rank == 4) %>% group_by(Winner) %>% count()
pred.4$Pct <- (pred.4$n/nsim)
colnames(pred.4) <- c("Winner", "n", "Fourth")
pred.5 <- standings %>% filter(Rank == 5) %>% group_by(Winner) %>% count()
pred.5$Pct <- (pred.5$n/nsim)
colnames(pred.5) <- c("Winner", "n", "Fifth")
pred.6 <- standings %>% filter(Rank > 5) %>% group_by(Winner) %>% count()
pred.6$Pct <- (pred.6$n/nsim)
colnames(pred.6) <- c("Winner", "n", "Out")
predictions <- ungroup(as.data.frame(standings$Winner[1:10]))
colnames(predictions) <- "Winner"
predictions <- pred.1 %>% select(-n) %>% right_join(predictions, by = "Winner")
predictions <- pred.2 %>% select(-n) %>% right_join(predictions, by = "Winner")
predictions <- pred.3 %>% select(-n) %>% right_join(predictions, by = "Winner")
predictions <- pred.4 %>% select(-n) %>% right_join(predictions, by = "Winner")
predictions <- pred.5 %>% select(-n) %>% right_join(predictions, by = "Winner")
predictions <- pred.6 %>% select(-n) %>% right_join(predictions, by = "Winner")
predictions$Team <- predictions$Winner
predictions <- predictions %>% left_join(current.elos, by = "Team")
predictions <- predictions %>% ungroup() %>% select(-Winner)
predictions <- predictions %>%
mutate(First = percent(First, 1)) %>%
mutate(Second = percent(Second, 1)) %>%
mutate(Third = percent(Third, 1)) %>%
mutate(Fourth = percent(Fourth, 1)) %>%
mutate(Fifth = percent(Fifth, 1)) %>%
mutate(Out = percent(Out, 1))
predictions <- predictions %>% select(Rank, Team, Elo, First, Second, Third, Fourth, Fifth, Out)
write_csv(predictions, "predictions.csv")
## Render Elo Pages
render("~/Google Drive/KBO/kbofancystats/content/elo.Rmd")
render("~/Google Drive/KBO/kbofancystats/content/elo2020.Rmd")
render("~/Google Drive/KBO/kbofancystats/content/elohistory.Rmd")
setwd("~/Google Drive/KBO/kbofancystats")
#stop_server()
serve_site()
# Leaders Homepage Widget
batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")
pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")
batters <- unique(batters)
pitchers <- unique(pitchers)
batters <- batters %>% filter(Year == 2020)
pitchers <- pitchers %>% filter(Year == 2020)
games <- max(batters$G)
batters <- batters %>% subset(PA > (3.1*games))
pitchers <- pitchers %>% subset(IP2 > games)
batwar <- batters %>% select(Code,Name,Team,Position,WAR)
pitwar <- pitchers %>% select(Code,Name,Team,Position,WAR)
d <- rbind(batwar,pitwar)
d <- d %>% arrange(desc(WAR))
d <- d[1:10,]
a <- '+++'
b <- 'widget = "blank"'
c <- 'headless = true'
dd <- 'active = true'
e <- 'weight = 2'
f <- 'title = "WAR Leaders"'
g <- '[design.spacing]'
h <- 'padding = ["50px", "25%", "0px", "25%"]'
ii <- '[design.background]'
j <- 'color = "white"'
k <- '+++'
l <- '| Rank | Name | Team | Position | WAR |'
m <- '| :---: | --- | --- | ------- | -- |'
war1 <- paste0('| 1 | [**',as.character(d[1,2]),'**](/players/',as.character(d[1,1]),') | [',as.character(d[1,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[1,3])), ') | ', as.character(d[1,4]),' | ',sprintf('%.2f',d[1,5]),' |')
war2 <- paste0('| 2 | [**',as.character(d[2,2]),'**](/players/',as.character(d[2,1]),') | [',as.character(d[2,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[2,3])), ') | ', as.character(d[2,4]),' | ',sprintf('%.2f',d[2,5]),' |')
war3 <- paste0('| 3 | [**',as.character(d[3,2]),'**](/players/',as.character(d[3,1]),') | [',as.character(d[3,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[3,3])), ') | ', as.character(d[3,4]),' | ',sprintf('%.2f',d[3,5]),' |')
war4 <- paste0('| 4 | [**',as.character(d[4,2]),'**](/players/',as.character(d[4,1]),') | [',as.character(d[4,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[4,3])), ') | ', as.character(d[4,4]),' | ',sprintf('%.2f',d[4,5]),' |')
war5 <- paste0('| 5 | [**',as.character(d[5,2]),'**](/players/',as.character(d[5,1]),') | [',as.character(d[5,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[5,3])), ') | ', as.character(d[5,4]),' | ',sprintf('%.2f',d[5,5]),' |')
setwd("~/Google Drive/KBO/kbofancystats/content/home")
writeLines(c(a,b,c,dd,e,f,g,h,ii,j,k,l,m,war1,war2,war3,war4,war5), "blank.md")
library(blogdown)
library(rmarkdown)
setwd("~/Google Drive/KBO")
## Blank Data Sets
pitchers <- NA
batters <- NA
## Scrape Daily Box Scores for Active Players
all.links <- NA
for (i in 7696:7700){
print(i)
url <- paste0("https://mykbostats.com/games/",i)
links <- read_html(url) %>% html_nodes("table") %>% html_nodes("a") %>% html_attr("href")
links <- links[str_detect(links, "players")]
all.links <- append(all.links, links)
}
all.links <- all.links[2:length(all.links)]
all.links <- unique(all.links)
## Scrape Players' 2020 Stats
for (i in 1:length(all.links)){
print(i/length(all.links))
url <- paste0("https://mykbostats.com",all.links[i])
site <- read_html(url)
player <- site %>% html_table(fill = T)
player <- as.data.frame(player[1])
player <- player[1,]
player$Code <- gsub("\\D", "", url)
## Add Name, Position, Etc.
d <- site %>%
html_node("h1") %>% html_text()
d <- gsub("[\r\n]", "", d)
d <- strsplit(d, "[|()#]")
player$Name <- substring(d[[1]][1], first = 1, last = (nchar(d[[1]][1]))-1)
player$Position <- substring(d[[1]][5], first = 2)
player$Number <- substring(d[[1]][4], first = 1, last = (nchar(d[[1]][4]))-1)
player$KName <- d[[1]][2]
## Add To Batter or Pitcher Data
if (length(player) == 33) {
pitchers <- rbind(pitchers, player)
} else {
batters <- rbind(batters, player)
}
}
pitchers <- pitchers[2:nrow(pitchers),]
names(pitchers)[8] <- "Hold"
names(pitchers)[19] <- "H"
batters <- batters[2:nrow(batters),]
batters <- batters %>% filter(Year == 2020)
pitchers <- pitchers %>% filter(Year == 2020)
batters$Code <- (as.numeric(batters$Code) * 7) + 5
pitchers$Code <- (as.numeric(pitchers$Code) * 7) + 5
### Fix Teams
batters$Team <- as.factor(batters$Team)
batters$Team <- recode(batters$Team,
"Doosan" = "Doosan Bears",
"Hanwha" = "Hanwha Eagles",
"Kia" = "Kia Tigers",
"Kiwoom" = "Kiwoom Heroes",
"KT" = "KT Wiz",
"LG" = "LG Twins",
"Lotte" = "Lotte Giants",
"NC" = "NC Dinos",
"Nexen" = "Kiwoom Heroes",
"Samsung" = "Samsung Lions",
"SK" = "SK Wyverns")
pitchers$Team <- as.factor(pitchers$Team)
pitchers$Team <- recode(pitchers$Team,
"Doosan" = "Doosan Bears",
"Hanwha" = "Hanwha Eagles",
"Kia" = "Kia Tigers",
"Kiwoom" = "Kiwoom Heroes",
"KT" = "KT Wiz",
"LG" = "LG Twins",
"Lotte" = "Lotte Giants",
"NC" = "NC Dinos",
"Nexen" = "Kiwoom Heroes",
"Samsung" = "Samsung Lions",
"SK" = "SK Wyverns")
#### Do the Fancy Stats
## Add Park Factors
pf <- read_csv("parkfactors.csv")
batters <- batters %>% left_join(pf, by = "Team")
pitchers <- pitchers %>% left_join(pf, by = "Team")
## Guts
guts <- read_csv("guts.csv")
guts <- guts %>% subset(Season > 1998)
wBB <- mean(guts$wBB)
wHBP <- mean(guts$wHBP)
w1B <- mean(guts$w1B)
w2B <- mean(guts$w2B)
w3B <- mean(guts$w3B)
wHR <- mean(guts$wHR)
runSB <- mean(guts$runSB)
runCS <- mean(guts$runCS)
## Fix Basics
batters$X1B <- batters$H-batters$X2B-batters$X3B-batters$HR
pitchers$IP2 <- pitchers$IP
pitchers <- pitchers %>% separate(IP, c("a", "b"))
pitchers$b <-  substring(pitchers$b, first = 5, last = 5)
pitchers$b[is.na(pitchers$b)] <- 0
pitchers$IP <- as.numeric(pitchers$a) + as.numeric(pitchers$b)*(1/3)
pitchers$IP2 <- paste0(pitchers$a,".",pitchers$b)
pitchers <- pitchers %>% select(-a, -b)
# Batter background
lgAB = sum(batters$AB, na.rm=TRUE)
lgPA = sum(batters$PA, na.rm=TRUE)
lgSF = sum(batters$SF, na.rm=TRUE)
lgBB = sum(batters$BB, na.rm=TRUE)
lgIBB = sum(batters$IBB, na.rm=TRUE)
lgHBP = sum(batters$HBP, na.rm=TRUE)
lgH = sum(batters$H, na.rm=TRUE)
lg1B = sum(batters$X1B, na.rm=TRUE)
lg2B = sum(batters$X2B, na.rm=TRUE)
lg3B = sum(batters$X3B, na.rm=TRUE)
lgHR = sum(batters$HR, na.rm=TRUE)
lgSB = sum(batters$SB, na.rm=TRUE)
lgCS = sum(batters$CS, na.rm=TRUE)
lgR = sum(batters$R, na.rm=TRUE)
lgRPA <- lgR/lgPA
lgwOBA <- (wBB*(lgBB-lgIBB) + wHBP*lgHBP + w1B*lg1B + w2B*lg2B + w3B*lg3B + wHR*lgHR)/(lgPA)
wOBAscale <- lgwOBA/.250
lgOBP <- (lgH + lgBB - lgIBB + lgHBP)/(lgPA)
lgwSB <- (lgSB * runSB + lgCS * runCS) / (lg1B + lgBB + lgHBP - lgIBB)
lgwRC <- (lgwOBA/wOBAscale+lgRPA)*lgPA
## Pitcher background
lgIPp <- sum(pitchers$IP, na.rm=TRUE)
lgRp <- sum(pitchers$R, na.rm=TRUE)
lgERp <- sum(pitchers$ER, na.rm=TRUE)
lgSOp <- sum(pitchers$SO, na.rm=TRUE)
lgRp <- sum(pitchers$R, na.rm=TRUE)
lgHRp <- sum(pitchers$HR, na.rm=TRUE)
lgBBp <- sum(pitchers$BB, na.rm=TRUE)
lgHBPp <- sum(pitchers$HB, na.rm=TRUE)
lgGSp <- sum(pitchers$GS, na.rm=TRUE)
lgGSp <- lgGSp/2
RPW <- 9*(lgRp/lgIPp)*1.5 + 3
lgRA9 <- (lgRp/lgIPp)*9
lgERA <- (lgERp/lgIPp)*9
FIPcon <- lgERA - (((13*lgHRp)+(3*(lgBBp+lgHBPp))-(2*lgSOp))/lgIPp)
lgFIPR9 <- lgERA + (lgRA9 - lgERA)
## Batter Stats
batters$wOBA <- (wBB*(batters$BB-batters$IBB) + wHBP*batters$HBP + w1B*batters$X1B + w2B*batters$X2B + w3B*batters$X3B + wHR*batters$HR)/(batters$PA)
batters$wRAA <- ((batters$wOBA-lgwOBA)/wOBAscale)*batters$PA
batters$WAR <- ((batters$wRAA + (lgRPA - (batters$PF*(lgRPA)))*batters$PA) + (batters$SB*runSB + batters$CS*runCS - lgwSB * (batters$X1B + batters$BB + batters$HBP - batters$IBB)) + (((lgGSp*.2345)*((lgGSp)/lgGSp))*(RPW/lgPA) * batters$PA))/RPW
batters$wRC <- (((batters$wOBA-lgwOBA)/wOBAscale)+(lgRPA))*batters$PA
batters$wRCplus <- (((batters$wRAA/batters$PA + lgRPA) + (lgRPA - batters$PF*lgRPA))/(lgRPA))*100
batters$BBpct <- (batters$BB/batters$PA)*100
batters$SOpct <- (batters$SO/batters$PA)*100
batters$OBP <- (batters$H + batters$BB + batters$HBP)/(batters$PA)
batters$SLG <- (batters$X1B + (2*batters$X2B) + (3*batters$X3B) + (4*batters$HR))/batters$AB
batters$OPS <- batters$OBP + batters$SLG
batters$BA <- batters$H/batters$AB
batters$ISO <- batters$SLG-batters$BA
batters$BABIP <- (batters$H - batters$HR)/(batters$AB - batters$SO - batters$HR + batters$SF)
## Pitcher Stats
pitchers$FIP <- ((13*pitchers$HR)+(3*(pitchers$BB+pitchers$HB))-(2*pitchers$SO))/pitchers$IP + FIPcon
pitchers$FIPR9 <- pitchers$FIP + (lgRA9 - lgERA)
pitchers$pFIPR9 <- pitchers$FIPR9/pitchers$PF
pitchers$dRPW <- (((((18 - pitchers$IP/pitchers$G)*(lgFIPR9)) + ((pitchers$IP/pitchers$G)*pitchers$pFIPR9)) / 18) + 2)*1.5
pitchers$RAAP9 <- lgFIPR9 - pitchers$pFIPR9
pitchers$WPGAA <- pitchers$RAAP9 / pitchers$dRPW
pitchers$RepLev <- 0.03*(1 - pitchers$GS/pitchers$G) + 0.12*(pitchers$GS/pitchers$G)
pitchers$WPGAR <- pitchers$WPGAA + pitchers$RepLev
pitchers$WAR <- pitchers$WPGAR * (pitchers$IP/9)
pitchers$BABIP <- (pitchers$H - pitchers$HR)/(pitchers$TBF - pitchers$BB - pitchers$IBB - pitchers$HB - pitchers$SO - pitchers$HR)
pitchers$SO9 <- pitchers$SO/pitchers$IP*9
pitchers$BB9 <- pitchers$BB/pitchers$IP*9
pitchers$HR9 <- pitchers$HR/pitchers$IP*9
## Lists for pages
listbat <- batters %>% select(Name, Code, KName, Team, Position)
listpit <- pitchers %>% select(Name, Code, KName, Team, Position)
## Combine with Un-Updated 2020
batnoupdate <- read_csv("batters_full_20.csv")
pitnoupdate <- read_csv("pitchers_full_20.csv")
batcodes <- batters$Code
batnoupdate <- batnoupdate %>% filter(!Code %in% batcodes)
pitcodes <- pitchers$Code
pitnoupdate <- pitnoupdate %>% filter(!Code %in% pitcodes)
batters <- rbind(batters, batnoupdate)
pitchers <- rbind(pitchers, pitnoupdate)
write_csv(batters, "batters_full_20.csv")
write_csv(pitchers, "pitchers_full_20.csv")
# Team Stats
teamsbat <- batters %>% select(Team, BB, IBB, HBP, X1B, X2B, X3B, HR, PA, R)
teamsbat <- aggregate(.~Team, teamsbat, sum)
teamsbat$wOBA <- (wBB*(teamsbat$BB-teamsbat$IBB) + wHBP*teamsbat$HBP + w1B*teamsbat$X1B + w2B*teamsbat$X2B + w3B*teamsbat$X3B + wHR*teamsbat$HR)/(teamsbat$PA)
teamspit <- pitchers %>% select(Team, ER, IP, HR, BB, HB, SO)
teamspit <- aggregate(.~Team, teamspit, sum)
tpER <- sum(teamspit$ER)
tpIP <- sum(teamspit$IP)
tpHR <- sum(teamspit$HR)
tpBB <- sum(teamspit$BB)
tpHBP <- sum(teamspit$HB)
tpSO <- sum(teamspit$SO)
tpERA <- (tpER/tpIP)*9
tFIPcon <- tpERA - (((13*tpHR)+(3*(tpBB+tpHBP))-(2*tpSO))/tpIP)
teamspit$FIP <- ((13*teamspit$HR)+(3*(teamspit$BB+teamspit$HB))-(2*teamspit$SO))/teamspit$IP + tFIPcon
teamstats <- teamsbat %>% left_join(teamspit, by = "Team") %>% select(Team, wOBA, FIP)
write_csv(teamstats, "teamstats.csv")
## Reduce
batters.20 <- batters %>% select(Year, Name, KName, Position, Team, G, PA, HR, OPS, BBpct, SOpct, ISO, BABIP, wRCplus, WAR, Code)
pitchers.20 <- pitchers %>% select(Year, Name, KName, Position, Team, G, GS, IP2, SO9, BB9, HR9, BABIP, ERA, FIP, WAR, Code)
## Combine With Pre-2020 Stats
batters.1019 <- read_csv("batters_simple_10to19.csv")
pitchers.1019 <- read_csv("pitchers_simple_10to19.csv")
batters.all <- rbind(batters.1019,batters.20)
pitchers.all <- rbind(pitchers.1019,pitchers.20)
batters.all <- unique(batters.all)
pitchers.all <- unique(pitchers.all)
## Save
write_csv(batters.all, "batters_simple.csv")
write_csv(pitchers.all, "pitchers_simple.csv")
## Start Site
setwd("~/Google Drive/KBO/kbofancystats")
serve_site()
## Write and Update Pages
setwd("~/Google Drive/KBO/kbofancystats/content/teams")
batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")
pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")
list <- batters %>% filter(Year == "2020") %>% select(Team)
list <- unique(list$Team)
batleaders <- batters %>% select(Name, Position, WAR, Year, Team)
pitleaders <- pitchers %>% select(Name, Position, WAR, Year, Team)
leaders <- rbind(batleaders, pitleaders)
tops <- leaders %>% filter(Year == "2020") %>% group_by(Team) %>% top_n(3, WAR)
tops <- tops[order(-tops$WAR),]
tops$WAR <- round(tops$WAR, 2)
current.elos <- read_csv("~/Google Drive/KBO/currentelos.csv")
current.elos$Elo <- round(current.elos$Elo, 0)
cities <- read_csv("~/Google Drive/KBO/teamcities.csv")
tops <- tops %>% left_join(cities, by = "Team")
for (i in list){
top <- tops %>% filter(Team == i)
top3 <- paste0("WAR Leader | ",top[1,1],", ",top[1,2],": ",top[1,3])
elo <- current.elos %>% filter(Team == i)
elo <- paste0(top[1,6]," | Current Elo: ",elo[1,2]," (",elo[1,3],")")
a <- "---"
b <- 'date: "2020-03-31"'
c <- paste0("summary: ","'", top3,"'")
d <- paste0("title: ","'", i,"'")
da <- paste0("subtitle: ","'", elo,"'")
db <- "image:"
dc <- "  preview_only: true"
ea <- "**2020** | [Batting](#batting) | [Pitching](#pitching) | "
eaa <- paste0("**2019** | [Batting](https://www.kbofancystats.com/2019-stats/", gsub("[[:space:]]", "", i),"/#batting) | [Pitching](https://www.kbofancystats.com/2019-stats/",gsub("[[:space:]]", "", i),"/#pitching) | ")
eb <- " "
e <- "### 2020 Batting Stats {#batting}"
f <- "```{r pressure, echo=F,warning=FALSE,message=FALSE}"
g <- "library(tidyverse)"
j <- "library(kableExtra)"
k <- 'batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")'
l <- "batters <- batters[complete.cases(batters),]"
m <- "#batters$Age <- as.numeric(batters$Age)"
n <- paste0('d <- batters %>% filter(Team == "', i, '") %>% filter(Year == "2020") %>% select(-Team, -Year, -KName)')
o <- "d <- d[order(-d$WAR),]"
p <- 'd$Name <- paste0("[", d$Name, "](/players/", d$Code, ")")'
q <- 'kable(d, digits = c(0,0,0,0,0,3,1,1,3,3,1,2), col.names = c("Name","Pos","G","PA","HR","OPS","BB%","SO%","ISO","BABIP","wRC+","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>%column_spec(1, bold = T, border_right = F)'
r <- "```"
rr <- "***"
s <- "### 2020 Pitching Stats {#pitching}"
t <- "```{r, echo=F,warning=FALSE,message=FALSE}"
u <- 'pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")'
v <- 'pitchers <- pitchers[complete.cases(pitchers),]'
w <- paste0('d <- pitchers %>% filter(Team == "', i, '") %>% filter(Year == "2020") %>% select(-Team, -Year, -KName, -Position)')
x <- 'd <- d[order(-d$WAR),]'
y <- 'd$Name <- paste0("[", d$Name, "](/players/", d$Code, ")")'
ab <- "d <- d %>% select(-Code)"
z <- 'kable(d, digits = c(0,0,0,1,1,1,1,3,3,2,2), col.names = c("Name","G","GS","IP","K/9","BB/9","HR/9","BABIP","ERA","FIP","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>% column_spec(1, bold = T, border_right = F)'
teamwd <- paste0("~/Google Drive/KBO/kbofancystats/content/teams/",gsub("[[:space:]]", "", i))
setwd(teamwd)
file <- "index.rmd"
writeLines(c(a,b,c,d,da,db,dc,a,ea,eaa,eb,rr,e,f,g,j,k,l,m,n,o,p,ab,q,r,rr,s,t,u,v,w,x,y,ab,z,r), file)
}
setwd("~/Google Drive/KBO/kbofancystats/content/players")
#list <- batters %>% select(Name, Code, KName, Team, Position)
list <- listbat
for (i in 1:nrow(list)){
title <- paste0(list$Name[i], " | ", list$KName[i])
subtitle <- paste0(list$Team[i], " | ", list$Position[i])
id <- list$Code[i]
a <- "---"
b <- paste0('title: ', title)
bb <- paste0('subtitle: ', subtitle)
bc <- 'summary: "Career Stats"'
c <- "```{r , echo=F,warning=FALSE,message=FALSE}"
f <- "library(kableExtra)"
g <- 'd <- read.csv("~/Google Drive/KBO/batters_simple.csv")'
j <- paste0('d <- subset(d, Code == "', id, '", select = c(-Name, -KName, -Position, -Code))')
k <- 'd <- d[order(-d$Year),]'
k2 <- 'd$Team <- paste0("[", d$Team, "](/teams/", gsub("[[:space:]]", "", d$Team), ")")'
l <- 'kable(d, digits = c(0,0,0,0,0,3,1,1,3,3,1,2), row.names = FALSE, col.names = c("Season","Team","G","PA","HR","OPS","BB%","SO%","ISO","BABIP","wRC+","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T)'
m <- "```"
file <- paste0(gsub("[[:space:]]", "", id), ".rmd")
writeLines(c(a,b,bb,bc,a,c,f,g,j,k,k2,l,m), file)
}
setwd("~/Google Drive/KBO/kbofancystats/content/players")
#list <- pitchers %>% select(Name, Code, KName, Team, Position)
list <- listpit
for (i in 1:nrow(list)){
title <- paste0(list$Name[i], " | ", list$KName[i])
subtitle <- paste0(list$Team[i], " | ", list$Position[i])
id <- list$Code[i]
a <- "---"
b <- paste0('title: ', title)
bb <- paste0('subtitle: ', subtitle)
bc <- 'summary: "Career Stats"'
c <- "```{r , echo=F,warning=FALSE,message=FALSE}"
f <- "library(kableExtra)"
g <- 'd <- read.csv("~/Google Drive/KBO/pitchers_simple.csv")'
j <- paste0('d <- subset(d, Code == "', id, '", select = c(-Name, -KName, -Position, -Code))')
jj <- 'd <- subset(d, Year > 2013)'
k <- 'd <- d[order(-d$Year),]'
k2 <- 'd$Team <- paste0("[", d$Team, "](/teams/", gsub("[[:space:]]", "", d$Team), ")")'
l <- 'kable(d, digits = c(0,0,0,0,1,1,1,1,3,2,2,2), row.names = FALSE, col.names = c("Season","Team","G","GS","IP","K/9","BB/9","HR/9","BABIP","ERA","FIP","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T)'
m <- "```"
file <- paste0(gsub("[[:space:]]", "", id), ".rmd")
writeLines(c(a,b,bb,bc,a,c,f,g,j,jj,k,k2,l,m), file)
}
# Leaders Homepage Widget
batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")
pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")
batters <- unique(batters)
pitchers <- unique(pitchers)
batters <- batters %>% filter(Year == 2020)
pitchers <- pitchers %>% filter(Year == 2020)
games <- max(batters$G)
batters <- batters %>% subset(PA > (3.1*games))
pitchers <- pitchers %>% subset(IP2 > games)
batwar <- batters %>% select(Code,Name,Team,Position,WAR)
pitwar <- pitchers %>% select(Code,Name,Team,Position,WAR)
d <- rbind(batwar,pitwar)
d <- d %>% arrange(desc(WAR))
d <- d[1:10,]
a <- '+++'
b <- 'widget = "blank"'
c <- 'headless = true'
dd <- 'active = true'
e <- 'weight = 2'
f <- 'title = "WAR Leaders"'
g <- '[design.spacing]'
h <- 'padding = ["50px", "25%", "0px", "25%"]'
ii <- '[design.background]'
j <- 'color = "white"'
k <- '+++'
l <- '| Rank | Name | Team | Position | WAR |'
m <- '| :---: | --- | --- | ------- | -- |'
war1 <- paste0('| 1 | [**',as.character(d[1,2]),'**](/players/',as.character(d[1,1]),') | [',as.character(d[1,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[1,3])), ') | ', as.character(d[1,4]),' | ',sprintf('%.2f',d[1,5]),' |')
war2 <- paste0('| 2 | [**',as.character(d[2,2]),'**](/players/',as.character(d[2,1]),') | [',as.character(d[2,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[2,3])), ') | ', as.character(d[2,4]),' | ',sprintf('%.2f',d[2,5]),' |')
war3 <- paste0('| 3 | [**',as.character(d[3,2]),'**](/players/',as.character(d[3,1]),') | [',as.character(d[3,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[3,3])), ') | ', as.character(d[3,4]),' | ',sprintf('%.2f',d[3,5]),' |')
war4 <- paste0('| 4 | [**',as.character(d[4,2]),'**](/players/',as.character(d[4,1]),') | [',as.character(d[4,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[4,3])), ') | ', as.character(d[4,4]),' | ',sprintf('%.2f',d[4,5]),' |')
war5 <- paste0('| 5 | [**',as.character(d[5,2]),'**](/players/',as.character(d[5,1]),') | [',as.character(d[5,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[5,3])), ') | ', as.character(d[5,4]),' | ',sprintf('%.2f',d[5,5]),' |')
setwd("~/Google Drive/KBO/kbofancystats/content/home")
writeLines(c(a,b,c,dd,e,f,g,h,ii,j,k,l,m,war1,war2,war3,war4,war5), "blank.md")
# Refresh Pages
render("~/Google Drive/KBO/kbofancystats/content/leaders.Rmd")
render("~/Google Drive/KBO/kbofancystats/content/elo.Rmd")
View(teamstats)
View(teamstats)
View(teamstats)
View(teamstats)
batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")
pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")
batters <- unique(batters)
pitchers <- unique(pitchers)
batters <- batters %>% filter(Year == 2020)
pitchers <- pitchers %>% filter(Year == 2020)
batwar <- batters %>% select(Code,Name,Team,Position,WAR)
pitwar <- pitchers %>% select(Code,Name,Team,Position,WAR)
d <- rbind(batwar,pitwar)
d <- d %>% arrange(desc(WAR))
d <- d[1:10,]
a <- '+++'
b <- 'widget = "blank"'
c <- 'headless = true'
dd <- 'active = true'
e <- 'weight = 2'
f <- 'title = "WAR Leaders"'
g <- '[design.spacing]'
h <- 'padding = ["50px", "25%", "0px", "25%"]'
ii <- '[design.background]'
j <- 'color = "white"'
k <- '+++'
l <- '| Rank | Name | Team | Position | WAR |'
m <- '| :---: | --- | --- | ------- | -- |'
war1 <- paste0('| 1 | [**',as.character(d[1,2]),'**](/players/',as.character(d[1,1]),') | [',as.character(d[1,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[1,3])), ') | ', as.character(d[1,4]),' | ',sprintf('%.2f',d[1,5]),' |')
war2 <- paste0('| 2 | [**',as.character(d[2,2]),'**](/players/',as.character(d[2,1]),') | [',as.character(d[2,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[2,3])), ') | ', as.character(d[2,4]),' | ',sprintf('%.2f',d[2,5]),' |')
war3 <- paste0('| 3 | [**',as.character(d[3,2]),'**](/players/',as.character(d[3,1]),') | [',as.character(d[3,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[3,3])), ') | ', as.character(d[3,4]),' | ',sprintf('%.2f',d[3,5]),' |')
war4 <- paste0('| 4 | [**',as.character(d[4,2]),'**](/players/',as.character(d[4,1]),') | [',as.character(d[4,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[4,3])), ') | ', as.character(d[4,4]),' | ',sprintf('%.2f',d[4,5]),' |')
war5 <- paste0('| 5 | [**',as.character(d[5,2]),'**](/players/',as.character(d[5,1]),') | [',as.character(d[5,3]),'](/teams/',gsub("[[:space:]]", "", as.character(d[5,3])), ') | ', as.character(d[5,4]),' | ',sprintf('%.2f',d[5,5]),' |')
setwd("~/Google Drive/KBO/kbofancystats/content/home")
writeLines(c(a,b,c,dd,e,f,g,h,ii,j,k,l,m,war1,war2,war3,war4,war5), "blank.md")
