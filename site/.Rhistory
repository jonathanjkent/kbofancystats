colnames(y) <- x
y$Name <- substring(d[[1]][1], first = 1, last = (nchar(d[[1]][1]))-1)
y$Position <- substring(d[[1]][5], first = 2)
y$Team <- substring(d[[1]][3], first = 1, last = (nchar(d[[1]][3]))-1)
y$Number <- substring(d[[1]][4], first = 1, last = (nchar(d[[1]][4]))-1)
y$Link <- playerurls[i]
players <- rbind(players, y)
print(i)
}
View(players)
players2 <- players
players <- players[2:nrow(players),]
View(players)
write_csv(players," mykboplayers.csv")
pitchers <- read_csv("pitchers.csv")
batters <- read_csv("batters.csv")
#
batters <- batters %>% subset(Season == "2019")
pitchers <- pitchers %>% subset(Season == "2019")
#
batters <- batters %>% subset(Season == "2019") %>% select(Name, Team, ID)
View(batters)
pitchers <- pitchers %>% subset(Season == "2019") %>% select(Name, Team, ID)
batters$Pos <- "H"
pitchers$Pos <- "P"
bref <- rbind(batters, pitchers)
write_csv(bref,"bref.csv")
newnames <- read_csv("bref.csv")
test <- unique(bref$mykboID)
bref$mykboID
View(bref)
View(newnames)
test <- unique(newnames$mykboID)
newnames <- read_csv("bref.csv")
View(newnames)
playerurls <- paste0("https://mykbostats.com/players/", newnames$mykboID)
players <- data.frame(matrix(ncol = 5, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(players) <- x
for (i in 1:3){
d <- read_html(playerurls[i]) %>%
html_node("h1") %>% html_text()
d <- gsub("[\r\n]", "", d)
d <- strsplit(d, "[|()#]")
y <- data.frame(matrix(ncol = 5, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(y) <- x
y$Name <- substring(d[[1]][1], first = 1, last = (nchar(d[[1]][1]))-1)
y$Position <- substring(d[[1]][5], first = 2)
y$Team <- substring(d[[1]][3], first = 1, last = (nchar(d[[1]][3]))-1)
y$Number <- substring(d[[1]][4], first = 1, last = (nchar(d[[1]][4]))-1)
y$KName <- d[[1]][2]
y$Link <- playerurls[i]
players <- rbind(players, y)
print(i)
}
players <- data.frame(matrix(ncol = 6, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(players) <- x
for (i in 1:3){
d <- read_html(playerurls[i]) %>%
html_node("h1") %>% html_text()
d <- gsub("[\r\n]", "", d)
d <- strsplit(d, "[|()#]")
y <- data.frame(matrix(ncol = 6, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(y) <- x
y$Name <- substring(d[[1]][1], first = 1, last = (nchar(d[[1]][1]))-1)
y$Position <- substring(d[[1]][5], first = 2)
y$Team <- substring(d[[1]][3], first = 1, last = (nchar(d[[1]][3]))-1)
y$Number <- substring(d[[1]][4], first = 1, last = (nchar(d[[1]][4]))-1)
y$KName <- d[[1]][2]
y$Link <- playerurls[i]
players <- rbind(players, y)
print(i)
}
View(players)
players <- data.frame(matrix(ncol = 6, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(players) <- x
for (i in 1:length(playerurls)){
d <- read_html(playerurls[i]) %>%
html_node("h1") %>% html_text()
d <- gsub("[\r\n]", "", d)
d <- strsplit(d, "[|()#]")
y <- data.frame(matrix(ncol = 6, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(y) <- x
y$Name <- substring(d[[1]][1], first = 1, last = (nchar(d[[1]][1]))-1)
y$Position <- substring(d[[1]][5], first = 2)
y$Team <- substring(d[[1]][3], first = 1, last = (nchar(d[[1]][3]))-1)
y$Number <- substring(d[[1]][4], first = 1, last = (nchar(d[[1]][4]))-1)
y$KName <- d[[1]][2]
y$Link <- playerurls[i]
players <- rbind(players, y)
print(i)
}
players <- data.frame(matrix(ncol = 6, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(players) <- x
for (i in 1:length(playerurls)){
d <- read_html(playerurls[i]) %>%
html_node("h1") %>% html_text()
d <- gsub("[\r\n]", "", d)
d <- strsplit(d, "[|()#]")
y <- data.frame(matrix(ncol = 6, nrow = 1))
x <- c("Name", "KName", "Team", "Position", "Number", "Link")
colnames(y) <- x
y$Name <- substring(d[[1]][1], first = 1, last = (nchar(d[[1]][1]))-1)
y$Position <- substring(d[[1]][5], first = 2)
y$Team <- substring(d[[1]][3], first = 1, last = (nchar(d[[1]][3]))-1)
y$Number <- substring(d[[1]][4], first = 1, last = (nchar(d[[1]][4]))-1)
y$KName <- d[[1]][2]
y$Link <- playerurls[i]
players <- rbind(players, y)
print(i)
}
View(players)
View(newnames)
players2 <- players
View(pitchers)
View(players)
View(newnames)
players2$mykboID <- substring(players2$Link, first = 25)
View(players2)
players2$mykboID <- substring(players2$Link, first = 32)
everyone <- newnames %>% left_join(players2, by = "mykboID")
players2 <- players2[2:nrow(players2),]
everyone <- newnames %>% left_join(players2, by = "mykboID")
View(newnames)
players2$mykboID <- as.numeric(players2$mykboID)
everyone <- newnames %>% left_join(players2, by = "mykboID")
View(everyone)
everyone$nametest <- everyone$Name.y == everyone$mykboName
brefIDs <- newnames %>% select(ID, mykboID)
namematches <- brefIDs %>% left_join(players2 by = "mykboID")
namematches <- brefIDs %>% left_join(players2, by = "mykboID")
View(namematches)
namematches <- brefIDs %>% left_join(players2, by = "mykboID") %>% select(-Link)
View(namematches)
write_csv(namematches,"namematches.csv")
# Save/Read CSVs
#write_csv(pitchers, "pitchers.csv")
#write_csv(batters, "batters.csv")
pitchers <- read_csv("pitchers.csv")
batters <- read_csv("batters.csv")
# Add mykbo Names
mykbo <- read_csv("namematches.csv")
pitchers <- pitchers %>% left_join(namematches, by = "ID")
warnings()
View(pitchers)
namematches <- brefIDs %>% left_join(players2, by = "mykboID") %>% select(-Link, -Team)
View(namematches)
namematches$kName <- namematches$Name
namematches <- namematches %>% select(-Name)
View(namematches)
write_csv(namematches,"namematches.csv")
pitchers <- read_csv("pitchers.csv")
batters <- read_csv("batters.csv")
# Add mykbo Names
mykbo <- read_csv("namematches.csv")
pitchers <- pitchers %>% left_join(namematches, by = "ID")
View(pitchers)
namematches <- brefIDs %>% left_join(players2, by = "mykboID") %>% select(-Link, -Team)
namematches$Name.mykbo <- namematches$Name
namematches <- namematches %>% select(-Name)
write_csv(namematches,"namematches.csv")
pitchers <- read_csv("pitchers.csv")
batters <- read_csv("batters.csv")
# Add mykbo Names
mykbo <- read_csv("namematches.csv")
pitchers <- pitchers %>% left_join(namematches, by = "ID")
pitchers <- pitchers %>% left_join(namematches, by = "ID")
batters <- batters %>% left_join(namematches, by = "ID")
pitchers <- read_csv("pitchers.csv")
batters <- read_csv("batters.csv")
# Add mykbo Names
mykbo <- read_csv("namematches.csv")
pitchers <- pitchers %>% left_join(namematches, by = "ID")
batters <- batters %>% left_join(namematches, by = "ID")
View(batters)
# Clean IDs
pitchers$ID <- gsub("[[:punct:]]", "", pitchers$ID, perl=TRUE)
batters$ID <- gsub("[[:punct:]]", "", batters$ID, perl=TRUE)
# Add Park Factors
pf <- read_csv("parkfactors.csv")
batters <- batters %>% left_join(pf, by = "Team")
pitchers <- pitchers %>% left_join(pf, by = "Team")
batters$PF[is.na(batters$PF)] <- 1
pitchers$PF[is.na(pitchers$PF)] <- 1
# Fill NAs
batters$`2B`[is.na(batters$`2B`)] <- 0
batters$`3B`[is.na(batters$`3B`)] <- 0
batters$BA[is.na(batters$BA)] <- 0
batters$OBP[is.na(batters$OBP)] <- 0
batters$SLG[is.na(batters$SLG)] <- 0
batters$OPS[is.na(batters$OPS)] <- 0
batters$TB[is.na(batters$TB)] <- 0
batters$GDP[is.na(batters$GDP)] <- 0
batters$SH[is.na(batters$SH)] <- 0
batters$SF[is.na(batters$SF)] <- 0
batters$IBB[is.na(batters$IBB)] <- 0
pitchers$IBB[is.na(pitchers$IBB)] <- 0
pitchers$BK[is.na(pitchers$BK)] <- 0
pitchers$BF[is.na(pitchers$BF)] <- 0
# Create Guts
guts <- read_csv("guts.csv")
guts <- guts %>% subset(Season > 1998)
wBB <- mean(guts$wBB)
wHBP <- mean(guts$wHBP)
w1B <- mean(guts$w1B)
w2B <- mean(guts$w2B)
w3B <- mean(guts$w3B)
wHR <- mean(guts$wHR)
runSB <- mean(guts$runSB)
runCS <- mean(guts$runCS)
# Fix Basics
batters$`1B` <- batters$H-batters$`2B`-batters$`3B`-batters$HR
pitchers$IP2 <- pitchers$IP
pitchers <- pitchers %>% separate(IP, c("a", "b"))
pitchers$b[is.na(pitchers$b)] <- 0
pitchers$IP <- as.numeric(pitchers$a) + as.numeric(pitchers$b)*(1/3)
pitchers <- pitchers %>% select(-a, -b)
# Batter background
batters <- batters %>% group_by(Season) %>% summarize(lgAB = sum(AB)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgPA = sum(PA)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgSF = sum(SF)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgBB = sum(BB)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgIBB = sum(IBB)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgHBP = sum(HBP)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgH = sum(H)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lg1B = sum(`1B`)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lg2B = sum(`2B`)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lg3B = sum(`3B`)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgHR = sum(HR)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgSB = sum(SB)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgCS = sum(CS)) %>% left_join(batters, by = "Season")
batters <- batters %>% group_by(Season) %>% summarize(lgR = sum(R)) %>% left_join(batters, by = "Season")
batters$lgRPA <- batters$lgR/batters$lgPA
batters$lgwOBA <- (wBB*(batters$lgBB-batters$lgIBB) + wHBP*batters$lgHBP + w1B*batters$lg1B + w2B*batters$lg2B + w3B*batters$lg3B + wHR*batters$lgHR)/(batters$lgPA)
batters$wOBAscale <- batters$lgwOBA/.250
batters$lgOBP <- (batters$lgH + batters$lgBB - batters$lgIBB + batters$lgHBP)/(batters$lgPA)
batters$lgwSB <- (batters$lgSB * runSB + batters$lgCS * runCS) / (batters$lg1B + batters$lgBB + batters$lgHBP - batters$lgIBB)
batters$lgwRC <- (batters$lgwOBA/batters$wOBAscale+batters$lgRPA)*batters$lgPA
# Pitcher background
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgIP = sum(IP)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgR = sum(R)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgER = sum(ER)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgSO = sum(SO)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgHR = sum(HR)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgBB = sum(BB)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgHBP = sum(HBP)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgGS = sum(GS)) %>% left_join(pitchers, by = "Season")
pitchers$lgGS <- pitchers$lgGS/2
gs <- pitchers %>% group_by(Season) %>% summarise(lgGS = mean(lgGS))
batters <- batters %>% left_join(gs, by = "Season")
pitchers$RPW <- 9*(pitchers$lgR/pitchers$lgIP)*1.5 + 3
rpw <- pitchers %>% group_by(Season) %>% summarise(RPW = mean(RPW))
batters <- batters %>% left_join(rpw, by = "Season")
pitchers$lgRA9 <- (pitchers$lgR/pitchers$lgIP)*9
pitchers$lgERA <- (pitchers$lgER/pitchers$lgIP)*9
pitchers$FIPcon <- pitchers$lgERA - (((13*pitchers$lgHR)+(3*(pitchers$lgBB+pitchers$lgHBP))-(2*pitchers$lgSO))/pitchers$lgIP)
pitchers$lgFIP <- ((13*pitchers$lgHR)+(3*(pitchers$lgBB+pitchers$lgHBP))-(2*pitchers$lgSO))/pitchers$lgIP + pitchers$FIPcon
pitchers$lgFIPR9 <- pitchers$lgFIP + (pitchers$lgRA9 - pitchers$lgERA)
# Batter Stats
batters$wOBA <- (wBB*(batters$BB-batters$IBB) + wHBP*batters$HBP + w1B*batters$`1B` + w2B*batters$`2B` + w3B*batters$`3B` + wHR*batters$HR)/(batters$PA)
batters$wRAA <- ((batters$wOBA-batters$lgwOBA)/batters$wOBAscale)*batters$PA
batters$WAR <- ((batters$wRAA + (batters$lgRPA - (batters$PF*(batters$lgRPA)))*batters$PA) + (batters$SB*runSB + batters$CS*runCS - batters$lgwSB * (batters$`1B` + batters$BB + batters$HBP - batters$IBB)) + (((batters$lgGS*.2345)*((batters$lgGS)/batters$lgGS))*(batters$RPW/batters$lgPA) * batters$PA))/batters$RPW
batters$wRC <- (((batters$wOBA-batters$lgwOBA)/batters$wOBAscale)+(batters$lgRPA))*batters$PA
batters$wRCplus <- (((batters$wRAA/batters$PA + batters$lgRPA) + (batters$lgRPA - batters$PF*batters$lgRPA))/(batters$lgRPA))*100
batters$BBpct <- (batters$BB/batters$PA)*100
batters$SOpct <- (batters$SO/batters$PA)*100
batters$ISO <- batters$SLG-batters$BA
batters$BABIP <- (batters$H - batters$HR)/(batters$AB - batters$SO - batters$HR + batters$SF)
# Pitcher Stats
pitchers$FIP <- ((13*pitchers$HR)+(3*(pitchers$BB+pitchers$HBP))-(2*pitchers$SO))/pitchers$IP + pitchers$FIPcon
pitchers$FIPR9 <- pitchers$FIP + (pitchers$lgRA9 - pitchers$lgERA)
pitchers$pFIPR9 <- pitchers$FIPR9/pitchers$PF
pitchers$dRPW <- (((((18 - pitchers$IP/pitchers$G)*(pitchers$lgFIPR9)) + ((pitchers$IP/pitchers$G)*pitchers$pFIPR9)) / 18) + 2)*1.5
pitchers$RAAP9 <- pitchers$lgFIPR9 - pitchers$pFIPR9
pitchers$WPGAA <- pitchers$RAAP9 / pitchers$dRPW
pitchers$RepLev <- 0.03*(1 - pitchers$GS/pitchers$G) + 0.12*(pitchers$GS/pitchers$G)
pitchers$WPGAR <- pitchers$WPGAA + pitchers$RepLev
pitchers$WAR <- pitchers$WPGAR * (pitchers$IP/9)
#pitchers$WAR <- pitchers$WAR + (-0.0009*pitchers$IP)
pitchers$BABIP <- (pitchers$H - pitchers$HR)/(pitchers$BF - pitchers$BB - pitchers$IBB - pitchers$HBP - pitchers$SO - pitchers$HR)
# Summary Tables
batters.simple <- batters %>% select(Season, Name, KName, Name.mykbo, Position, ID, Team, Age, G, PA, HR, OPS, BBpct, SOpct, ISO, BABIP, wRCplus, WAR)
pitchers.simple <- pitchers %>% select(Season, Name, KName, Name.mykbo, Position, ID, Team, Age, G, GS, IP2, SO9, BB9, HR9, BABIP, ERA, FIP, WAR)
write_csv(batters.simple, "batters_simple.csv")
write_csv(pitchers.simple, "pitchers_simple.csv")
# Batter Position Adjustment
batters$PosAdj <- batters$Position
batters$PosAdj
summary(batters$PosAdj)
# Batter Position Adjustment
batters$PosAdj <- as.factor(batters$Position)
summary(batters$PosAdj)
fct_recode(batters$PosAdj, 12.5 = "C")
fct_recode(batters$PosAdj, "12.5" = "C")
batters$PosAdj <- fct_recode(batters$PosAdj, "12.5" = "C")
summary(batters$PosAdj)
batters$PosAdj <- fct_recode(batters$PosAdj, "-12.5" = "1B")
summary(batters$PosAdj)
batters$PosAdj <- fct_recode(batters$PosAdj, "2.5" = "2B", "2.5" = "3B", "2.5" = "CF")
summary(batters$PosAdj)
batters$PosAdj <- fct_recode(batters$PosAdj, "7.5" = "SS")
batters$PosAdj <- fct_recode(batters$PosAdj, "-7.5" = "LF", "-7.5" = "RF")
batters$PosAdj <- fct_recode(batters$PosAdj, "7.5" = "SS")
batters$PosAdj <- fct_recode(batters$PosAdj, "7.5" = "SS")
summary(batters$PosAdj)
batters$PosAdj <- fct_recode(batters$PosAdj, "-17.5" = "DH")
batters$PosAdj <- fct_recode(batters$PosAdj, "-12.5" = "OF")
batters$PosAdj <- fct_recode(batters$PosAdj, "0" = "IF", "0" = "LHP", "0" = "RHP", "0" = "NA")
batters$PosAdj <- fct_recode(batters$PosAdj, "0" = "IF", "0" = "LHP", "0" = "RHP", "0" = NA)
summary(batters$PosAdj)
batters$PosAdj[is.na(batters$PosAdj)] <- "0"
summary(batters$PosAdj)
batters$PosAdj <- as.numeric(batters$PosAdj)
summary(batters$PosAdj)
batters$PosAdj <- as.factor(batters$Position)
batters$PosAdj <- fct_recode(batters$PosAdj, "12.5" = "C")
batters$PosAdj <- fct_recode(batters$PosAdj, "-12.5" = "1B")
batters$PosAdj <- fct_recode(batters$PosAdj, "2.5" = "2B", "2.5" = "3B", "2.5" = "CF")
batters$PosAdj <- fct_recode(batters$PosAdj, "7.5" = "SS")
batters$PosAdj <- fct_recode(batters$PosAdj, "-7.5" = "LF", "-7.5" = "RF")
batters$PosAdj <- fct_recode(batters$PosAdj, "-17.5" = "DH")
batters$PosAdj <- fct_recode(batters$PosAdj, "-17.5" = "DH")
batters$PosAdj <- fct_recode(batters$PosAdj, "-12.5" = "OF")
batters$PosAdj <- fct_recode(batters$PosAdj, "0" = "IF", "0" = "LHP", "0" = "RHP")
batters$PosAdj[is.na(batters$PosAdj)] <- "0"
batters$PosAdj <- fct_recode(batters$PosAdj, 12.5 = "C")
batters$PosAdj <- fct_recode(batters$PosAdj, 12.5 == "C")
batters$PosAdj <- as.numeric(batters$PosAdj)
batters$PosAdj <- as.factor(batters$Position)
batters$PosAdj <- fct_recode(batters$PosAdj, "12.5" = "C")
batters$PosAdj <- fct_recode(batters$PosAdj, "-12.5" = "1B")
batters$PosAdj <- fct_recode(batters$PosAdj, "2.5" = "2B", "2.5" = "3B", "2.5" = "CF")
batters$PosAdj <- fct_recode(batters$PosAdj, "7.5" = "SS")
batters$PosAdj <- fct_recode(batters$PosAdj, "-7.5" = "LF", "-7.5" = "RF")
batters$PosAdj <- fct_recode(batters$PosAdj, "-17.5" = "DH")
batters$PosAdj <- fct_recode(batters$PosAdj, "-17.5" = "DH")
batters$PosAdj <- fct_recode(batters$PosAdj, "-12.5" = "OF")
batters$PosAdj <- fct_recode(batters$PosAdj, "0" = "IF", "0" = "LHP", "0" = "RHP")
batters$PosAdj[is.na(batters$PosAdj)] <- "0"
batters$PosAdj <- parse_guess(batters$PosAdj)
batters$PosAdj <- as.character(batters$PosAdj)
batters$PosAdj <- parse_guess(batters$PosAdj)
summary(batters$PosAdj)
# Pitcher background
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgIP = sum(IP)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgR = sum(R)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgER = sum(ER)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgSO = sum(SO)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgHR = sum(HR)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgBB = sum(BB)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgHBP = sum(HBP)) %>% left_join(pitchers, by = "Season")
pitchers <- pitchers %>% group_by(Season) %>% summarize(lgGS = sum(GS)) %>% left_join(pitchers, by = "Season")
pitchers$lgGS <- pitchers$lgGS/2
gs <- pitchers %>% group_by(Season) %>% summarise(lgGS = mean(lgGS))
batters <- batters %>% left_join(gs, by = "Season")
pitchers$RPW <- 9*(pitchers$lgR/pitchers$lgIP)*1.5 + 3
rpw <- pitchers %>% group_by(Season) %>% summarise(RPW = mean(RPW))
batters <- batters %>% left_join(rpw, by = "Season")
pitchers$lgRA9 <- (pitchers$lgR/pitchers$lgIP)*9
pitchers$lgERA <- (pitchers$lgER/pitchers$lgIP)*9
pitchers$FIPcon <- pitchers$lgERA - (((13*pitchers$lgHR)+(3*(pitchers$lgBB+pitchers$lgHBP))-(2*pitchers$lgSO))/pitchers$lgIP)
pitchers$lgFIP <- ((13*pitchers$lgHR)+(3*(pitchers$lgBB+pitchers$lgHBP))-(2*pitchers$lgSO))/pitchers$lgIP + pitchers$FIPcon
pitchers$lgFIPR9 <- pitchers$lgFIP + (pitchers$lgRA9 - pitchers$lgERA)
# Batter Stats
batters$wOBA <- (wBB*(batters$BB-batters$IBB) + wHBP*batters$HBP + w1B*batters$`1B` + w2B*batters$`2B` + w3B*batters$`3B` + wHR*batters$HR)/(batters$PA)
batters$wRAA <- ((batters$wOBA-batters$lgwOBA)/batters$wOBAscale)*batters$PA
batters$WAR <- ((batters$wRAA + (batters$lgRPA - (batters$PF*(batters$lgRPA)))*batters$PA) + (batters$SB*runSB + batters$CS*runCS - batters$lgwSB * (batters$`1B` + batters$BB + batters$HBP - batters$IBB)) + (((batters$lgGS*.2345)*((batters$lgGS)/batters$lgGS))*(batters$RPW/batters$lgPA) * batters$PA)) + batters$PosAdj/batters$RPW
batters$wRC <- (((batters$wOBA-batters$lgwOBA)/batters$wOBAscale)+(batters$lgRPA))*batters$PA
batters$wRCplus <- (((batters$wRAA/batters$PA + batters$lgRPA) + (batters$lgRPA - batters$PF*batters$lgRPA))/(batters$lgRPA))*100
batters$BBpct <- (batters$BB/batters$PA)*100
batters$SOpct <- (batters$SO/batters$PA)*100
batters$ISO <- batters$SLG-batters$BA
batters$BABIP <- (batters$H - batters$HR)/(batters$AB - batters$SO - batters$HR + batters$SF)
# Pitcher Stats
pitchers$FIP <- ((13*pitchers$HR)+(3*(pitchers$BB+pitchers$HBP))-(2*pitchers$SO))/pitchers$IP + pitchers$FIPcon
pitchers$FIPR9 <- pitchers$FIP + (pitchers$lgRA9 - pitchers$lgERA)
pitchers$pFIPR9 <- pitchers$FIPR9/pitchers$PF
pitchers$dRPW <- (((((18 - pitchers$IP/pitchers$G)*(pitchers$lgFIPR9)) + ((pitchers$IP/pitchers$G)*pitchers$pFIPR9)) / 18) + 2)*1.5
pitchers$RAAP9 <- pitchers$lgFIPR9 - pitchers$pFIPR9
pitchers$WPGAA <- pitchers$RAAP9 / pitchers$dRPW
pitchers$RepLev <- 0.03*(1 - pitchers$GS/pitchers$G) + 0.12*(pitchers$GS/pitchers$G)
pitchers$WPGAR <- pitchers$WPGAA + pitchers$RepLev
pitchers$WAR <- pitchers$WPGAR * (pitchers$IP/9)
#pitchers$WAR <- pitchers$WAR + (-0.0009*pitchers$IP)
pitchers$BABIP <- (pitchers$H - pitchers$HR)/(pitchers$BF - pitchers$BB - pitchers$IBB - pitchers$HBP - pitchers$SO - pitchers$HR)
# Summary Tables
batters.simple <- batters %>% select(Season, Name, KName, Name.mykbo, Position, ID, Team, Age, G, PA, HR, OPS, BBpct, SOpct, ISO, BABIP, wRCplus, WAR)
write_csv(batters.simple, "batters_simple.csv")
pitchers.simple <- pitchers %>% select(Season, Name, KName, Name.mykbo, Position, ID, Team, Age, G, GS, IP2, SO9, BB9, HR9, BABIP, ERA, FIP, WAR)
write_csv(pitchers.simple, "pitchers_simple.csv")
View(batters.simple)
library(tidyverse)
setwd("~/Google Drive/KBO/site/content/teams")
batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")
list <- batters %>% group_by(Team) %>% subset(Season == "2019") %>% select(Team)
list <- unique(list$Team)
d <- batters %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season)
d <- batters %>% subset(Team == "LG Twins") %>% subset(Season == "2019") %>% select(-Team, -Season)
View(d)
for (i in list){
team <- i
a <- "---"
b <- 'date: "2020-03-31"'
c <- 'summary: Fancy Stats'
d <- paste0("title: ", team)
e <- "## 2019 Batting Stats"
f <- "```{r pressure, echo=F,warning=FALSE,message=FALSE}"
g <- "library(tidyverse)"
h <- "library(knitr)"
j <- "library(kableExtra)"
k <- 'batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")'
l <- "batters <- batters[complete.cases(batters),]"
m <- "batters$Age <- as.numeric(batters$Age)"
n <- paste0('d <- batters %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season, -Name, -KName)')
o <- "d <- d[order(-d$WAR),]"
p <- 'd$Name <- paste0("[", d$Name, "](/players/", d$ID, ")")'
q <- 'kable(d, digits = c(0,0,0,0,0,0,3,1,1,3,3,1,2), col.names = c("Name","Pos","Age","G","PA","HR","OPS","BB%","SO%","ISO","BABIP","wRC+","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>%column_spec(1, bold = T, border_right = T)'
r <- "```"
s <- "## 2019 Pitching Stats"
t <- "```{r, echo=F,warning=FALSE,message=FALSE}"
u <- 'pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")'
v <- 'pitchers <- pitchers[complete.cases(pitchers),]'
w <- paste0('d <- pitchers %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season, -Name, -KName, -Position)')
x <- 'd <- d[order(-d$WAR),]'
y <- 'd$Name <- paste0("[", d$Name, "](/players/", d$ID, ")")'
ab <- "d <- d %>% select(-ID)"
z <- 'kable(d, digits = c(0,0,0,0,0,1,1,1,3,2,2,2), col.names = c("Name","Age","G","GS","IP","K/9","BB/9","HR/9","BABIP","ERA","FIP","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>% column_spec(1, bold = T, border_right = T)'
file <- paste0(gsub("[[:space:]]", "", team), ".rmd")
writeLines(c(a,b,c,d,a,e,f,g,h,j,k,l,m,n,o,p,ab,q,r,s,t,u,v,w,x,y,ab,z,r), file)
}
library(tidyverse)
library(knitr)
library(kableExtra)
batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")
batters <- batters[complete.cases(batters),]
batters$Age <- as.numeric(batters$Age)
d <- batters %>% subset(Team == "Doosan Bears") %>% subset(Season == "2019") %>% select(-Team, -Season, -Name, -KName)
View(d)
d <- d[order(-d$WAR),]
for (i in list){
team <- i
a <- "---"
b <- 'date: "2020-03-31"'
c <- 'summary: Fancy Stats'
d <- paste0("title: ", team)
e <- "## 2019 Batting Stats"
f <- "```{r pressure, echo=F,warning=FALSE,message=FALSE}"
g <- "library(tidyverse)"
h <- "library(knitr)"
j <- "library(kableExtra)"
k <- 'batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")'
l <- "batters <- batters[complete.cases(batters),]"
m <- "batters$Age <- as.numeric(batters$Age)"
n <- paste0('d <- batters %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season, -KName)')
o <- "d <- d[order(-d$WAR),]"
p <- 'd$Name <- paste0("[", d$Name, "](/players/", d$ID, ")")'
q <- 'kable(d, digits = c(0,0,0,0,0,0,3,1,1,3,3,1,2), col.names = c("Name","Pos","Age","G","PA","HR","OPS","BB%","SO%","ISO","BABIP","wRC+","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>%column_spec(1, bold = T, border_right = T)'
r <- "```"
s <- "## 2019 Pitching Stats"
t <- "```{r, echo=F,warning=FALSE,message=FALSE}"
u <- 'pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")'
v <- 'pitchers <- pitchers[complete.cases(pitchers),]'
w <- paste0('d <- pitchers %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season, -KName, -Position)')
x <- 'd <- d[order(-d$WAR),]'
y <- 'd$Name <- paste0("[", d$Name, "](/players/", d$ID, ")")'
ab <- "d <- d %>% select(-ID, -Name)"
z <- 'kable(d, digits = c(0,0,0,0,0,1,1,1,3,2,2,2), col.names = c("Name","Age","G","GS","IP","K/9","BB/9","HR/9","BABIP","ERA","FIP","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>% column_spec(1, bold = T, border_right = T)'
file <- paste0(gsub("[[:space:]]", "", team), ".rmd")
writeLines(c(a,b,c,d,a,e,f,g,h,j,k,l,m,n,o,p,ab,q,r,s,t,u,v,w,x,y,ab,z,r), file)
}
for (i in list){
team <- i
a <- "---"
b <- 'date: "2020-03-31"'
c <- 'summary: Fancy Stats'
d <- paste0("title: ", team)
e <- "## 2019 Batting Stats"
f <- "```{r pressure, echo=F,warning=FALSE,message=FALSE}"
g <- "library(tidyverse)"
h <- "library(knitr)"
j <- "library(kableExtra)"
k <- 'batters <- read_csv("~/Google Drive/KBO/batters_simple.csv")'
l <- "batters <- batters[complete.cases(batters),]"
m <- "batters$Age <- as.numeric(batters$Age)"
n <- paste0('d <- batters %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season, -KName)')
o <- "d <- d[order(-d$WAR),]"
p <- 'd$Name <- paste0("[", d$Name, "](/players/", d$ID, ")")'
q <- 'kable(d, digits = c(0,0,0,0,0,0,3,1,1,3,3,1,2), col.names = c("Name","Pos","Age","G","PA","HR","OPS","BB%","SO%","ISO","BABIP","wRC+","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>%column_spec(1, bold = T, border_right = F)'
r <- "```"
s <- "## 2019 Pitching Stats"
t <- "```{r, echo=F,warning=FALSE,message=FALSE}"
u <- 'pitchers <- read_csv("~/Google Drive/KBO/pitchers_simple.csv")'
v <- 'pitchers <- pitchers[complete.cases(pitchers),]'
w <- paste0('d <- pitchers %>% subset(Team == "', team, '") %>% subset(Season == "2019") %>% select(-Team, -Season, -KName, -Position)')
x <- 'd <- d[order(-d$WAR),]'
y <- 'd$Name <- paste0("[", d$Name, "](/players/", d$ID, ")")'
ab <- "d <- d %>% select(-ID, -Name)"
z <- 'kable(d, digits = c(0,0,0,0,0,1,1,1,3,2,2,2), col.names = c("Name","Age","G","GS","IP","K/9","BB/9","HR/9","BABIP","ERA","FIP","WAR")) %>% kable_styling(bootstrap_options = c("striped", "hover"), fixed_thead = T) %>% column_spec(1, bold = T, border_right = F)'
file <- paste0(gsub("[[:space:]]", "", team), ".rmd")
writeLines(c(a,b,c,d,a,e,f,g,h,j,k,l,m,n,o,p,ab,q,r,s,t,u,v,w,x,y,ab,z,r), file)
}
library(blogdown)
library(rmarkdown)
setwd("~/Google Drive/KBO/site")
#new_site(theme = 'themefisher/academia-hugo')
render_site()
